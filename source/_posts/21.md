---
title: java native api 最简单实现
date: 2017-06-16 14:16:20
tags: [jni] 
categories: jni
---
### 一、定义native方法,并进行调用 

``` java
public class HelloWorld {
    
    static{
        //System.loadLibrary("HelloWorld");
        System.load("/home/winstar/Desktop/HelloWorld/HelloWorld.so");
    }

    private native void print();

    public static void main(String[] args) {
        new HelloWorld().print();
    }
}
```
 
 ### 二、进入java源文件目录,在console下执行如下命令,生成头文件HelloWorld.h
``` bash
$ javah -jni HelloWorld
```  

HelloWorld.h文件内容如下:  

``` c
  /* DO NOT EDIT THIS FILE - it is machine generated */
  #include <jni.h>
  /* Header for class HelloWorld */
  
  #ifndef _Included_HelloWorld
  #define _Included_HelloWorld
  #ifdef __cplusplus
  extern "C" {
  #endif
  /*
   * Class:     HelloWorld
   * Method:    print
   * Signature: ()V
   */
  JNIEXPORT void JNICALL Java_HelloWorld_print
    (JNIEnv *, jobject);
  
  #ifdef __cplusplus
  }
  #endif
  #endif
```  

 ### 三、新建HelloWorld.c文件,输出HelloWord并换行
 ``` c
   #include <jni.h>
   #include <stdio.h>
   #include "HelloWorld.h"
   JNIEXPORT void JNICALL Java_HelloWorld_print
      (JNIEnv *env, jobject obj){
        printf("HelloWorld\n");
     }
 ```  
 
 ### 四、通过gcc生成so文件以供jni调用
 ``` bash
 $  gcc HelloWorld.c -shared -fPIC  -I/home/winstar/.jenv/candidates/java/1.8.0_91/include -I/home/winstar/.jenv/candidates/java/1.8.0_91/include/linux -o HelloWorld.so
 ```  
 ### 五、生成class文件并执行,会看到控制台输出HelloWorld,jni调用成功
  ``` bash
  $ javac HelloWorld.java
    java HelloWorld
  ```  
  
 #### 常见问题:
 1. jdk版本和gcc版本要一致要么都32位要么都64位(本例是以ubuntu 64位为例)  
 
 2. gcc -I参数指定jdk中jni.h和jni_md.h路径  
 
 3. 如果使用32位gcc编译,命令如下:  
 
``` bash
 $  gcc HelloWorld.c -shared -m32  -I/home/winstar/.jenv/candidates/java/1.8.0_91/include -I/home/winstar/.jenv/candidates/java/1.8.0_91/include/linux -o HelloWorld.so
``` 
 